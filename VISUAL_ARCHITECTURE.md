# ğŸ¨ JobPsych Auth API - Visual Architecture Guide

This document provides visual representations of the system architecture, flows, and interactions.

---

## ğŸ“ System Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        JOBPSYCH AUTH API                             â”‚
â”‚                         (Express.js)                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                    ENTRY POINT                              â”‚    â”‚
â”‚  â”‚                    src/index.ts                             â”‚    â”‚
â”‚  â”‚  â€¢ CORS Configuration                                       â”‚    â”‚
â”‚  â”‚  â€¢ Cookie Parser                                            â”‚    â”‚
â”‚  â”‚  â€¢ Morgan Logger                                            â”‚    â”‚
â”‚  â”‚  â€¢ JSON Parser                                              â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                        â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                    ROUTING LAYER                            â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚  â€¢ /api/auth/*     â†’ authRoutes.ts                         â”‚    â”‚
â”‚  â”‚  â€¢ /api/auth/*     â†’ rateLimitRoutes.ts                    â”‚    â”‚
â”‚  â”‚  â€¢ /api/files/*    â†’ fileRoutes.ts                         â”‚    â”‚
â”‚  â”‚  â€¢ /              â†’ API Documentation                       â”‚    â”‚
â”‚  â”‚  â€¢ /health        â†’ Health Check                           â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                        â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                 MIDDLEWARE LAYER                            â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚  authenticate()                                             â”‚    â”‚
â”‚  â”‚  â”œâ”€ Extract JWT from Authorization header                  â”‚    â”‚
â”‚  â”‚  â”œâ”€ Verify token signature                                 â”‚    â”‚
â”‚  â”‚  â”œâ”€ Decode payload {userId, email}                         â”‚    â”‚
â”‚  â”‚  â””â”€ Attach to req.user â†’ pass to controller               â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                        â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              CONTROLLER LAYER                               â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚                                                             â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚    â”‚
â”‚  â”‚  â”‚ authController   â”‚  â”‚ rateLimitCtrl    â”‚               â”‚    â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤               â”‚    â”‚
â”‚  â”‚  â”‚ â€¢ register()     â”‚  â”‚ â€¢ getUserUploads â”‚               â”‚    â”‚
â”‚  â”‚  â”‚ â€¢ login()        â”‚  â”‚ â€¢ incrementUploadâ”‚               â”‚    â”‚
â”‚  â”‚  â”‚ â€¢ refresh()      â”‚  â”‚ â€¢ getUploadStats â”‚               â”‚    â”‚
â”‚  â”‚  â”‚ â€¢ logout()       â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚    â”‚
â”‚  â”‚  â”‚ â€¢ resetPassword()â”‚                                       â”‚    â”‚
â”‚  â”‚  â”‚ â€¢ changePassword â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚    â”‚
â”‚  â”‚  â”‚ â€¢ getProfile()   â”‚  â”‚  jwtController   â”‚               â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤               â”‚    â”‚
â”‚  â”‚                         â”‚ â€¢ verifyToken()  â”‚               â”‚    â”‚
â”‚  â”‚                         â”‚ â€¢ getJWTInfo()   â”‚               â”‚    â”‚
â”‚  â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚    â”‚
â”‚  â”‚                                                             â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                        â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                 UTILITY LAYER                               â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚  utils/auth.ts                                              â”‚    â”‚
â”‚  â”‚  â”œâ”€ hashPassword()                                          â”‚    â”‚
â”‚  â”‚  â”œâ”€ verifyPassword()                                        â”‚    â”‚
â”‚  â”‚  â”œâ”€ generateAccessToken()     (HS256, 15m)                 â”‚    â”‚
â”‚  â”‚  â”œâ”€ generateRefreshToken()    (HS256, 7d)                  â”‚    â”‚
â”‚  â”‚  â”œâ”€ verifyAccessToken()                                     â”‚    â”‚
â”‚  â”‚  â”œâ”€ verifyRefreshToken()                                    â”‚    â”‚
â”‚  â”‚  â””â”€ extractTokenFromHeader()                               â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                        â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              DATABASE LAYER (Drizzle ORM)                   â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚  db/index.ts â†’ NeonDB Connection                           â”‚    â”‚
â”‚  â”‚  models/users.model.ts â†’ User Schema                       â”‚    â”‚
â”‚  â”‚  models/files.model.ts â†’ Files Schema                      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                        â”‚                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â†“
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚   NeonDB (PostgreSQL) â”‚
              â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
              â”‚  â”‚  users table    â”‚  â”‚
              â”‚  â”‚  â€¢ id           â”‚  â”‚
              â”‚  â”‚  â€¢ email        â”‚  â”‚
              â”‚  â”‚  â€¢ password     â”‚  â”‚
              â”‚  â”‚  â€¢ refreshToken â”‚  â”‚
              â”‚  â”‚  â€¢ filesUploadedâ”‚  â”‚
              â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Complete Request Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   CLIENT    â”‚
â”‚  (Frontend) â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 1. HTTP Request
       â”‚    POST /api/auth/login
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         EXPRESS.js SERVER            â”‚
â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚    CORS Middleware          â”‚   â”‚
â”‚  â”‚    âœ“ Check origin           â”‚   â”‚
â”‚  â”‚    âœ“ Allow credentials      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚             â”‚                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚    Body Parser              â”‚   â”‚
â”‚  â”‚    âœ“ Parse JSON             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚             â”‚                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚    Router                   â”‚   â”‚
â”‚  â”‚    âœ“ Match route            â”‚   â”‚
â”‚  â”‚    âœ“ /api/auth/login        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚             â”‚                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Middleware (if protected)  â”‚   â”‚
â”‚  â”‚  âœ“ Extract JWT token        â”‚   â”‚
â”‚  â”‚  âœ“ Verify signature         â”‚   â”‚
â”‚  â”‚  âœ“ Attach req.user          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚             â”‚                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚    Controller               â”‚   â”‚
â”‚  â”‚    â€¢ Process business logic â”‚   â”‚
â”‚  â”‚    â€¢ Validate input         â”‚   â”‚
â”‚  â”‚    â€¢ Call database          â”‚   â”‚
â”‚  â”‚    â€¢ Generate response      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚             â”‚                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚    Database (Drizzle ORM)   â”‚   â”‚
â”‚  â”‚    â€¢ Execute query          â”‚   â”‚
â”‚  â”‚    â€¢ Return data            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚             â”‚                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â”‚ 2. HTTP Response
              â”‚    200 OK + JSON
              â†“
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚   CLIENT     â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” Authentication Flow Diagram

```
REGISTRATION FLOW
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Client                  API                     Database              Utils
  â”‚                      â”‚                          â”‚                  â”‚
  â”œâ”€ POST /register â”€â”€â”€â”€>â”‚                          â”‚                  â”‚
  â”‚  {email, password}   â”‚                          â”‚                  â”‚
  â”‚                      â”œâ”€ Check email exists â”€â”€â”€â”€>â”‚                  â”‚
  â”‚                      â”‚<â”€â”€ User exists? â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                  â”‚
  â”‚                      â”‚                          â”‚                  â”‚
  â”‚                      â”‚  IF NOT EXISTS:          â”‚                  â”‚
  â”‚                      â”œâ”€ hashPassword() â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚                      â”‚<â”€â”€ hashedPassword â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                      â”‚                          â”‚                  â”‚
  â”‚                      â”œâ”€ generateRefreshToken()â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚                      â”‚<â”€â”€ refreshToken â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                      â”‚                          â”‚                  â”‚
  â”‚                      â”œâ”€ INSERT user â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                  â”‚
  â”‚                      â”‚<â”€â”€ New user data â”€â”€â”€â”€â”€â”€â”€â”€â”¤                  â”‚
  â”‚                      â”‚                          â”‚                  â”‚
  â”‚                      â”œâ”€ generateAccessToken()â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚                      â”‚<â”€â”€ accessToken â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                      â”‚                          â”‚                  â”‚
  â”‚<â”€â”€ 201 Created â”€â”€â”€â”€â”€â”€â”¤                          â”‚                  â”‚
  â”‚    + accessToken     â”‚                          â”‚                  â”‚
  â”‚    + Set-Cookie      â”‚                          â”‚                  â”‚
  â”‚    + user data       â”‚                          â”‚                  â”‚
  â”‚                      â”‚                          â”‚                  â”‚


LOGIN FLOW
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Client                  API                     Database              Utils
  â”‚                      â”‚                          â”‚                  â”‚
  â”œâ”€ POST /login â”€â”€â”€â”€â”€â”€â”€>â”‚                          â”‚                  â”‚
  â”‚  {email, password}   â”‚                          â”‚                  â”‚
  â”‚                      â”œâ”€ Find user â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                  â”‚
  â”‚                      â”‚<â”€â”€ User data â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                  â”‚
  â”‚                      â”‚                          â”‚                  â”‚
  â”‚                      â”œâ”€ verifyPassword() â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚                      â”‚<â”€â”€ true/false â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                      â”‚                          â”‚                  â”‚
  â”‚                      â”‚  IF VALID:               â”‚                  â”‚
  â”‚                      â”œâ”€ generateAccessToken()â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚                      â”‚<â”€â”€ accessToken â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                      â”‚                          â”‚                  â”‚
  â”‚                      â”œâ”€ generateRefreshToken()â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚                      â”‚<â”€â”€ refreshToken â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                      â”‚                          â”‚                  â”‚
  â”‚                      â”œâ”€ UPDATE refresh token â”€â”€>â”‚                  â”‚
  â”‚                      â”‚<â”€â”€ Updated â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                  â”‚
  â”‚                      â”‚                          â”‚                  â”‚
  â”‚<â”€â”€ 200 OK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                          â”‚                  â”‚
  â”‚    + accessToken     â”‚                          â”‚                  â”‚
  â”‚    + Set-Cookie      â”‚                          â”‚                  â”‚
  â”‚    + user data       â”‚                          â”‚                  â”‚
  â”‚                      â”‚                          â”‚                  â”‚


TOKEN REFRESH FLOW
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Client                  API                     Database              Utils
  â”‚                      â”‚                          â”‚                  â”‚
  â”œâ”€ POST /refresh â”€â”€â”€â”€â”€>â”‚                          â”‚                  â”‚
  â”‚  Cookie: refreshTokenâ”‚                          â”‚                  â”‚
  â”‚                      â”‚                          â”‚                  â”‚
  â”‚                      â”œâ”€ Extract from cookie     â”‚                  â”‚
  â”‚                      â”œâ”€ verifyRefreshToken() â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚                      â”‚<â”€â”€ decoded/error â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                      â”‚                          â”‚                  â”‚
  â”‚                      â”œâ”€ Find user with token â”€â”€>â”‚                  â”‚
  â”‚                      â”‚<â”€â”€ User data â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                  â”‚
  â”‚                      â”‚                          â”‚                  â”‚
  â”‚                      â”œâ”€ Compare hashed tokens â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚                      â”‚<â”€â”€ true/false â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                      â”‚                          â”‚                  â”‚
  â”‚                      â”‚  IF VALID:               â”‚                  â”‚
  â”‚                      â”œâ”€ generateAccessToken()â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚                      â”‚<â”€â”€ NEW accessToken â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                      â”‚                          â”‚                  â”‚
  â”‚                      â”œâ”€ generateRefreshToken()â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚                      â”‚<â”€â”€ NEW refreshToken â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                      â”‚                          â”‚                  â”‚
  â”‚                      â”œâ”€ UPDATE refresh token â”€â”€>â”‚                  â”‚
  â”‚                      â”‚<â”€â”€ Updated â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                  â”‚
  â”‚                      â”‚                          â”‚                  â”‚
  â”‚<â”€â”€ 200 OK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                          â”‚                  â”‚
  â”‚    + NEW accessToken â”‚                          â”‚                  â”‚
  â”‚    + NEW Set-Cookie  â”‚  (Token Rotation!)       â”‚                  â”‚
  â”‚                      â”‚                          â”‚                  â”‚
```

---

## ğŸ“Š Rate Limiting Flow

```
FASTAPI INTEGRATION FLOW
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Frontend            FastAPI Backend         Express Auth API         Database
   â”‚                      â”‚                        â”‚                      â”‚
   â”‚                      â”‚                        â”‚                      â”‚
   â”œâ”€ 1. Login â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                      â”‚
   â”‚                      â”‚                        â”œâ”€ Authenticate â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                      â”‚                        â”‚<â”€â”€ User data â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚<â”€ JWT Token â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                      â”‚
   â”‚                      â”‚                        â”‚                      â”‚
   â”‚                      â”‚                        â”‚                      â”‚
   â”œâ”€ 2. Upload File + JWT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                      â”‚
   â”‚    with Resume       â”‚                        â”‚                      â”‚
   â”‚                      â”‚                        â”‚                      â”‚
   â”‚                      â”œâ”€ 3. Verify JWT â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                    â”‚
   â”‚                      â”‚    (Check signature)    â”‚                    â”‚
   â”‚                      â”‚<â”€â”€ Valid â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚
   â”‚                      â”‚                         â”‚                    â”‚
   â”‚                      â”œâ”€ 4. Check Limit â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                   â”‚
   â”‚                      â”‚    GET /user-uploads/   â”‚                    â”‚
   â”‚                      â”‚                         â”œâ”€ Query count â”€â”€â”€â”€â”€>â”‚
   â”‚                      â”‚                         â”‚<â”€â”€ filesUploaded â”€â”€â”¤
   â”‚                      â”‚<â”€â”€ Count: 3/10 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚
   â”‚                      â”‚                         â”‚                    â”‚
   â”‚                      â”‚  IF count < 10:         â”‚                    â”‚
   â”‚                      â”œâ”€ 5. Process File        â”‚                    â”‚
   â”‚                      â”‚    (AI Analysis)        â”‚                    â”‚
   â”‚                      â”‚                         â”‚                    â”‚
   â”‚                      â”œâ”€ 6. Increment Count â”€â”€â”€>â”‚                    â”‚
   â”‚                      â”‚    POST /increment      â”‚                    â”‚
   â”‚                      â”‚                         â”œâ”€ UPDATE + 1 â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                      â”‚                         â”‚<â”€â”€ New count: 4 â”€â”€â”€â”¤
   â”‚                      â”‚<â”€â”€ Updated: 4/10 â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚
   â”‚                      â”‚                         â”‚                    â”‚
   â”‚<â”€ 7. Success + Results â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚
   â”‚    (Analysis data)   â”‚                         â”‚                    â”‚
   â”‚                      â”‚                         â”‚                    â”‚
   â”‚                      â”‚  IF count >= 10:        â”‚                    â”‚
   â”‚                      â”œâ”€ X. Return 429          â”‚                    â”‚
   â”‚<â”€ 8. Rate Limited â”€â”€â”€â”¤    Too Many Requests    â”‚                    â”‚
   â”‚                      â”‚                         â”‚                    â”‚
```

---

## ğŸ” Middleware Authentication Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PROTECTED ENDPOINT REQUEST                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Client Request  â”‚
                    â”‚ GET /profile    â”‚
                    â”‚ Authorization:  â”‚
                    â”‚ Bearer <token>  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚      AUTHENTICATE MIDDLEWARE               â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚                                            â”‚
        â”‚  1. Extract Authorization Header           â”‚
        â”‚     â†“                                       â”‚
        â”‚  2. Parse "Bearer <token>"                 â”‚
        â”‚     â†“                                       â”‚
        â”‚  3. Token exists?                          â”‚
        â”‚     â”œâ”€ NO â”€â”€â†’ Return 401 Unauthorized     â”‚
        â”‚     â””â”€ YES                                  â”‚
        â”‚        â†“                                    â”‚
        â”‚  4. jwt.verify(token, JWT_ACCESS_SECRET)   â”‚
        â”‚     â”œâ”€ Invalid â”€â”€â†’ Return 401              â”‚
        â”‚     â””â”€ Valid                                â”‚
        â”‚        â†“                                    â”‚
        â”‚  5. Decode payload                         â”‚
        â”‚     { userId: "123", email: "user@ex.com" }â”‚
        â”‚        â†“                                    â”‚
        â”‚  6. Attach to request                      â”‚
        â”‚     req.user = decoded                     â”‚
        â”‚        â†“                                    â”‚
        â”‚  7. Call next() â”€â”€â†’ Pass to Controller    â”‚
        â”‚                                            â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Controller    â”‚
                    â”‚  Can access:    â”‚
                    â”‚  req.user.email â”‚
                    â”‚  req.user.userIdâ”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸŒ Cross-Service JWT Verification

```
EXPRESS.js JWT CONFIGURATION
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  JWT_ACCESS_SECRET = "343164a0c3..."    â”‚  â† MUST MATCH
â”‚  Algorithm: HS256                        â”‚
â”‚  Expiry: 15 minutes                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â”‚ Generates JWT
                â†“
   eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   Header      Payload           Signature
   (HS256)     (userId, email)   (HMAC SHA256)
                â”‚
                â”‚
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FastAPI JWT Verification                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  JWT_SECRET = "343164a0c3..."           â”‚  â† MUST MATCH
â”‚  Algorithm: HS256                        â”‚
â”‚                                          â”‚
â”‚  jwt.decode(token, JWT_SECRET, HS256)   â”‚
â”‚     â†“                                    â”‚
â”‚  âœ… Valid â†’ Process request             â”‚
â”‚  âŒ Invalid â†’ 403 Forbidden             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


TROUBLESHOOTING FLOW
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

        403 Forbidden Error?
              â”‚
              â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ GET /jwt-info       â”‚ â† Check Express.js config
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â†“
    Compare:
    â€¢ secretLength (should be 64)
    â€¢ secretFirstChars
    â€¢ secretLastChars
               â”‚
               â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Do they match       â”‚
    â”‚ FastAPI's secret?   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                   â”‚
    YES                 NO
     â”‚                   â”‚
     â†“                   â†“
  âœ… Good!          âŒ FIX SECRETS
  Test with         Update .env
  /verify-token     Restart servers
```

---

## ğŸ“¦ Data Flow Through System

```
USER REGISTRATION DATA FLOW
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Input (Client)                    Processing                    Storage (DB)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

{                                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  name: "John"      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚   Validate   â”‚
  email: "john@ex"  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚   Required   â”‚
  password: "pass"  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚   Fields     â”‚
  company: "Acme"   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚              â”‚
}                                 â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â”‚
                                         â†“
                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                  â”‚ Check Exists â”‚
                                  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â”‚
                                         â†“
Password: "pass"                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚ bcrypt.hash  â”‚
                                  â”‚ (12 rounds)  â”‚
                                  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜              users table
                                         â”‚                      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                                         â†“                      id: 1
                            Hashed: "$2b$12$..."                name: "John"
                                         â”‚                      email: "john@ex"
                                         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> password: "$2b$12$..."
                                         â”‚                      company: "Acme"
Generate Tokens              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           files_uploaded: 0
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚ generateRefreshTokenâ”‚           refresh_token: "$2b$12$..."
                             â”‚ generateAccessToken â”‚           created_at: NOW()
                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â†“
Response (Client)            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                             â”‚  Hash Refresh    â”‚
{                            â”‚  Store in DB     â”‚
  accessToken: "eyJ..."  <â”€â”€â”€â”¤  Return Access   â”‚
  user: {                    â”‚  Set Cookie      â”‚
    id: "1"                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    name: "John"
    email: "john@ex"
    filesUploaded: 0
  }
}
Cookie: refreshToken=...
```

---

## ğŸ”„ Token Lifecycle

```
TOKEN LIFECYCLE TIMELINE
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

t=0min                t=15min              t=7days
  â”‚                      â”‚                    â”‚
  â”œâ”€ Access Token â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚
  â”‚  (expires)           X (Invalid)          â”‚
  â”‚                      â”‚                    â”‚
  â”‚                      â”‚                    â”‚
  â”œâ”€ Refresh Token â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚  (expires)                                X (Invalid)
  â”‚                                           â”‚
  â”‚                                           â”‚
  â””â”€ User Activity â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
        â”‚              â”‚                      â”‚
        â”‚              â”‚                      â”‚
     Login         Token Refresh          Logout or
                   (get new tokens)       Token Expiry


TOKEN ROTATION ON REFRESH
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Before Refresh:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Client has:                          â”‚
â”‚ â€¢ Access Token A1 (expired)          â”‚
â”‚ â€¢ Refresh Token R1 (valid)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â†“ POST /refresh (Cookie: R1)
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Server validates R1                  â”‚
â”‚ â€¢ Verify signature                   â”‚
â”‚ â€¢ Check database                     â”‚
â”‚ â€¢ Confirm not revoked                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â†“ Generates NEW tokens
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Server creates:                      â”‚
â”‚ â€¢ NEW Access Token A2                â”‚
â”‚ â€¢ NEW Refresh Token R2               â”‚
â”‚ â€¢ Invalidates R1 in database        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â†“
After Refresh:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Client has:                          â”‚
â”‚ â€¢ Access Token A2 (fresh, 15m)       â”‚
â”‚ â€¢ Refresh Token R2 (fresh, 7d)       â”‚
â”‚ â€¢ R1 is now INVALID                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ Summary

This visual guide provides:

âœ… **Complete system architecture**
âœ… **Request/response flows**
âœ… **Authentication sequences**
âœ… **Rate limiting integration**
âœ… **Token lifecycle management**
âœ… **Cross-service communication**
âœ… **Troubleshooting diagrams**

For detailed code-level documentation, see:

- `SYSTEM_FLOW_DOCUMENTATION.md` - Complete flow documentation
- `FIX_403_FORBIDDEN.md` - JWT troubleshooting guide
- `API_DOCUMENTATION.md` - API endpoint reference

---

**Last Updated:** October 3, 2025  
**Version:** 2.0.0
